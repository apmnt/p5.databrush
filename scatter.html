<!DOCTYPE html>
<html>
  <head>
    <title>P5.js Scatter Plot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      #controls {
        margin-bottom: 20px;
      }
      button {
        padding: 8px 16px;
        margin: 0 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>P5.js Scatter Plot Demo</h1>
    <div id="controls">
      <button onclick="randomizeData()">Randomize Data</button>
      <button onclick="randomizeSizes()">Randomize Point Sizes</button>
      <button onclick="randomizeColorValues()">Randomize Color Values</button>
      <button onclick="toggleGroups()">Toggle Two Groups</button>
    </div>
    <div id="sketch-holder"></div>

    <script>
      let plotData = [];
      let pointSizes = [];
      let colorValues = [];
      let useGroups = false;

      function setup() {
        const canvas = createCanvas(600, 400);
        canvas.parent("sketch-holder");

        // Generate initial random data
        randomizeData();
      }

      function draw() {
        background(250);
        drawScatterPlot(
          width,
          height,
          plotData,
          pointSizes,
          colorValues,
          useGroups
        );
      }

      function drawScatterPlot(
        chartWidth,
        chartHeight,
        values,
        sizes = null,
        colors = null,
        groups = false
      ) {
        const padding = 40;
        const plotWidth = chartWidth - 2 * padding;
        const plotHeight = chartHeight - 2 * padding;

        // Find min/max values
        let minX = Infinity,
          maxX = -Infinity;
        let minY = Infinity,
          maxY = -Infinity;

        for (let point of values) {
          minX = min(minX, point.x);
          maxX = max(maxX, point.x);
          minY = min(minY, point.y);
          maxY = max(maxY, point.y);
        }

        // Add some padding to the value ranges
        const rangeMargin = 0.1;
        const xRange = maxX - minX;
        const yRange = maxY - minY;
        minX -= xRange * rangeMargin;
        maxX += xRange * rangeMargin;
        minY -= yRange * rangeMargin;
        maxY += yRange * rangeMargin;

        // Draw axes
        stroke(0);
        strokeWeight(1);
        line(padding, height - padding, width - padding, height - padding); // x-axis
        line(padding, padding, padding, height - padding); // y-axis

        // Draw axis labels and ticks
        textAlign(CENTER, CENTER);
        textSize(12);

        // X-axis ticks and labels
        for (let i = 0; i <= 5; i++) {
          const x = padding + (i * plotWidth) / 5;
          const value = minX + (i * (maxX - minX)) / 5;
          line(x, height - padding, x, height - padding + 5);
          // Add white background to labels
          fill(255);
          noStroke();
          rect(x - 20, height - padding + 5, 40, 20);
          fill(0);
          text(value.toFixed(1), x, height - padding + 15);
        }

        // Y-axis ticks and labels
        textAlign(RIGHT, CENTER);
        for (let i = 0; i <= 5; i++) {
          const y = height - padding - (i * plotHeight) / 5;
          const value = minY + (i * (maxY - minY)) / 5;
          line(padding - 5, y, padding, y);
          // Add white background to labels
          fill(255);
          noStroke();
          rect(0, y - 10, padding - 6, 20);
          fill(0);
          text(value.toFixed(1), padding - 10, y);
        }

        // Plot points
        noStroke();

        for (let i = 0; i < values.length; i++) {
          const point = values[i];
          const pointSize = sizes ? sizes[i] : 8;
          const colorValue = colors ? colors[i] : 0.5;

          // Set color for point
          if (groups) {
            if (i < values.length / 2) {
              // Group 1: Red gradient
              fill(
                lerpColor(color(255, 200, 200), color(255, 0, 0), colorValue)
              );
            } else {
              // Group 2: Blue gradient
              fill(
                lerpColor(color(200, 200, 255), color(0, 0, 255), colorValue)
              );
            }
          } else {
            // Single group: Blue to Red gradient
            fill(lerpColor(color(0, 0, 255), color(255, 0, 0), colorValue));
          }

          // Map data coordinates to screen coordinates
          const x = map(point.x, minX, maxX, padding, width - padding);
          const y = map(point.y, minY, maxY, height - padding, padding);

          circle(x, y, pointSize);
        }

        // Draw legend
        if (groups) {
          drawGroupLegend();
        } else {
          drawGradientLegend();
        }
      }

      function drawGroupLegend() {
        const legendWidth = 120;
        const legendHeight = 80;
        const x = width - legendWidth - 10;
        const y = 10;

        // Background
        fill(255);
        rect(x, y, legendWidth, legendHeight);

        // Group 1
        const gradient1 = drawingContext.createLinearGradient(
          x + 10,
          0,
          x + 50,
          0
        );
        gradient1.addColorStop(0, color(255, 200, 200));
        gradient1.addColorStop(1, color(255, 0, 0));
        drawingContext.fillStyle = gradient1;
        rect(x + 10, y + 10, 40, 20);

        // Group 2
        const gradient2 = drawingContext.createLinearGradient(
          x + 10,
          0,
          x + 50,
          0
        );
        gradient2.addColorStop(0, color(200, 200, 255));
        gradient2.addColorStop(1, color(0, 0, 255));
        drawingContext.fillStyle = gradient2;
        rect(x + 10, y + 40, 40, 20);

        // Labels
        fill(0);
        textAlign(LEFT, CENTER);
        text("Group 1", x + 60, y + 20);
        text("Group 2", x + 60, y + 50);
      }

      function drawGradientLegend() {
        const legendWidth = 120;
        const legendHeight = 50;
        const x = width - legendWidth - 10;
        const y = 10;

        // Background
        fill(255);
        rect(x, y, legendWidth, legendHeight);

        // Gradient
        const gradient = drawingContext.createLinearGradient(
          x + 10,
          0,
          x + legendWidth - 10,
          0
        );
        gradient.addColorStop(0, color(0, 0, 255));
        gradient.addColorStop(1, color(255, 0, 0));
        drawingContext.fillStyle = gradient;
        rect(x + 10, y + 10, legendWidth - 20, 20);

        // Labels
        fill(0);
        textAlign(CENTER, CENTER);
        textSize(10);
        text("0", x + 10, y + 40);
        text("1", x + legendWidth - 10, y + 40);
      }

      function randomizeData() {
        plotData = [];
        for (let i = 0; i < 50; i++) {
          plotData.push({
            x: random(-10, 10),
            y: random(-10, 10),
          });
        }
        // Reset sizes and colors when new data is generated
        pointSizes = [];
        colorValues = [];
      }

      function randomizeSizes() {
        pointSizes = [];
        for (let i = 0; i < plotData.length; i++) {
          pointSizes.push(random(4, 16));
        }
      }

      function randomizeColorValues() {
        colorValues = [];
        for (let i = 0; i < plotData.length; i++) {
          colorValues.push(random(0, 1));
        }
      }

      function toggleGroups() {
        useGroups = !useGroups;
      }
    </script>
  </body>
</html>
